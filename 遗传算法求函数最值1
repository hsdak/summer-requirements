//Rosenbrock函数的全局最大值计算
//max f(x1,x2)=100(x1^2-x2^2)^2+(1-x1)^2
//s.t. -2.048<=xi<=2.048(xi=1,2)
#include<iostream>
#include<ctime>
#include<cstdlib>
#include<vector>
using namespace std;
//初始群体的产生
void chushi(vector<vector<int> >&a){
	int i,j;
	for(i=0;i<4;i++){
		for(j=0;j<4;j+=2){
			srand(time(0));
			if(rand()%1000>500){
				a[i][j]=0;
				a[i][j+1]=1;
			}
			else{
				a[i][j]=1;
				a[i][j+1]=0;
			}
		}
	}
}
//适应度计算
int shiying(int a,int b,int c,int d){
	int f,x1,x2;
	x1=a*2+b;
	x2=c*2+d;
	f=100*(x1*x1-x2*x2)*(x1*x1-x2*x2)+(1-x1)*(1-x1);
	return f;
}
//选择运算
void xuanze(vector<vector<int> >&a){
	vector<vector<int> > b;
	int i,r;
	b=a;
	for(i=0;i<4;i++){
		srand(time(0));
		r=rand()%(a[0][4]+a[1][4]+a[2][4]+a[3][4]);
		if(r<a[0][4]){
			b[i]=a[0];
		}
		else if(r<a[1][4]){
			b[i]=a[1];
		}
		else if(r<a[2][4]){
			b[i]=a[2];
		}
		else if(r<a[3][4]){
			b[i]=a[3];
		}
		a=b;
	}
}
//交叉运算
void jiaocha(vector<vector<int> >&a){
	int r1,r2,t,i;
	bool flag[4]={false};
	srand(time(0));
	r1=rand()%4;
	flag[r1]=true;
	while(r2!=r1){
		srand(time(0));
		r2=rand()%4;
	}
	flag[r2]=true;
	t=a[r1][0];
	a[r1][0]=a[r2][0];
	a[r2][0]=t;
	t=a[r1][1];
	a[r1][1]=a[r2][1];
	a[r2][1]=t;
	for(i=0;i<4;i++){
		if(!flag[i]){
			r1=i;
		}
	}
	for(;i<4;i++){
		if(!flag[i]){
			r2=i;
		}
	}
	t=a[r1][0];
	a[r1][0]=a[r2][0];
	a[r2][0]=t;
	t=a[r1][1];
	a[r1][1]=a[r2][1];
	a[r2][1]=t;
}
//变异运算
void bianyi(vector<vector<int> >&a){
	int i,r1,r2;
	for(i=0;i<4;i++){
		srand(time(0));
		r1=rand()%1000;
		if(r1>500){
			srand(time(0));
			r2=rand()%1000;
			if(r2==0){
				if(a[i][0]==0){
				a[i][0]=1;
				a[i][1]=0;
				}
			}
			else{
				a[i][0]=0;
				a[i][1]=1;
			}
		}
		else{
			srand(time(0));
			r2=rand()%1000;
			if(r2==0){
				if(a[i][2]==0){
				a[i][2]=1;
				a[i][3]=0;
				}
			}
			else{
				a[i][2]=0;
				a[i][3]=1;
			}
		}
	}
}
//主函数
int main(){
	vector<vector<int> > a(4,vector<int>(5));
	int i,j,max;
    chushi(a);
	for(i=0;i<5;i++){
		for(j=0;j<4;j++){
			a[j][4]=shiying(a[j][0],a[j][1],a[j][2],a[j][3]);
		}
		xuanze(a);
		jiaocha(a);
		bianyi(a);
	}
	max=a[0][4];
	for(i=1;i<4;i++){
		if(max<a[i][4]){
			max=a[i][4];
		}
	}
	cout<<"max="<<max<<endl;
	return 0;
}
